import sagemaker
import boto3

from sagemaker.s3 import S3Uploader
from sagemaker.pytorch import PyTorch

sagemaker_session = sagemaker.Session()
bucket = sagemaker_session.default_bucket()
prefix = "sagemaker/MAR-0-1"
role = sagemaker.get_execution_role()
inputs = S3Uploader.upload("data", "s3://{}/{}/data".format(bucket, prefix))

estimator_bl = PyTorch(entry_point='baseline.py',
                    role=role,
                    py_version='py3',
                    framework_version='1.8.0',
                    instance_count=1,
                    instance_type='ml.g4dn.xlarge')

estimator_bl.fit(inputs)

estimator_kd = PyTorch(entry_point='kd.py',
                    role=role,
                    py_version='py3',
                    framework_version='1.8.0',
                    instance_count=1,
                    instance_type='ml.g4dn.xlarge')

estimator_kd.fit(inputs)

bucket_to_delete = boto3.resource('s3').Bucket('sagemaker-us-east-1-746211637891')
bucket_to_delete.objects.all().delete()
